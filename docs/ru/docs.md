# Документация colligendis

Утитила командной строки colligendis предназначеня для сборки и обработки статистики с различных источников.

На текущий момент поддерживаются следующие ресурсы:
- корпоративный блог на [habr.com](https://habr.com).

## Принцип работы

На текущий момент поддерживается полуручной режим работы: необходимо вручную выгрузить из панели управления блогов на Хабре файл со статистикой по статьям и скормить его утилите.

Загруженные результаты хранятся в SQLite-базе. Генерация выходного файла осуществляется на базе двух загруженных файлов (по идее, их нужно скачивать раз в неделю, чтобы соблюсти промежутки статистики).

## Установка

Скачайте последнюю версию из раздела релизов или соберите актуальную версию из main и положить ее в $PATH.

## Команды

Ознакомиться с перечнем основных команды и ключей можно [на соответствующей странице документации](./commands.md).

Также можно выполнить любую команду с ключом `-h` для просмотра докментации прямо в терминале. Например:
```shell
$ colligendis 
A command-line utility for obtaining various statistics and reports on it.

Usage:
  colligendis [command]

Available Commands:
  collect     Сollect statistics from loaded sources.
  completion  Generate the autocompletion script for the specified shell
  config      Various utility settings
  help        Help about any command
  load        Load statistics from sources
  view        Displaying various information in the terminal

Flags:
  -h, --help      help for colligendis
  -v, --verbose   Show the full report of the commands

Use "colligendis [command] --help" for more information about a command.
```

## Сбор статистики и просмотр результатов

### Загрузка источника с Хабра

Перейдите в раздел _«Публикации»_ личного кабинета корпоративного блога и скачайте там файл CSV со статистикой по статьям:
<p align="center">
  <img src="./images/habr_get_stats.png">
</p>

### Загрузка файла в colligendis

В каталоге с файлом выполните команду `colligendis load -habr -f *.csv`, где `*.csv` — название скачанного файла. Поддерживается множественная загрузка сразу из нескольких файлов: `colligendis load -habr -a` — в этом режиме будут перебраны все `*.csv`-файлы в $PWD и по очереди загружены в БД.

> По какой-то причине скачанные файлы не всегда в UTF-8, а в UTF-16LE. Если утилита ругается на кодировку (исходный файл не в UTF-8), то воспользуйтесь скриптом `convert_csv.sh`, расположенным в корне репозитория. Выполните его командой `sh ./convert_csv.sh *.csv`, указав вместо `*.csv` имя файла, кодировку которого нужно изменить. Файл будет перекодирован в UTF-8 с сохранением имени.
>
> Для работы скрипта нужно, чтобы в системе была установлена утилита `iconv`. Также вместо скрипта можно выполнить конвертацию вручную: `iconv -f utf-16le -t utf-8 "$filename" > result.csv`.

## Просмотр статистики и информации

Просмотреть статистику можно командой `view`. Введите `colligendis view -h` для просмотра подробностей.

Например, просмотреть все статьи в блоге можно командой `colligendis view habr --articles`. Вывод можно отсортировать ключом `-s` по дате (`date`) или по названию (`name`), например, `colligendis view habr --articles -s name`.  В результате будет отображена таблица с перечнем статей.

## Генерация статистики в PDF

Для генерации в PDF используется LaTeX, он должен быть установлен в системе. Например, сгенерировать статистику по Хабру можно командой `colligendis collect --habr --file`. Если все пройдет успешно, в $PWD или рядом с исполняемым файлов появится PDF-файл stats.pdf, со подробной статистикой по блогу.

